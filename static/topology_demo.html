<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Topology Visualization Demo</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0f172a;
            color: #e2e8f0;
            padding: 20px;
            margin: 0;
        }
        .demo-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            color: #a78bfa;
            margin-bottom: 30px;
        }
        .topology-demo {
            background: #1e293b;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 20px;
        }
        .btn {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            color: white;
        }
        .btn-primary { background: #3b82f6; }
        .btn-success { background: #10b981; }
        .btn-danger { background: #ef4444; }
    </style>
</head>
<body>
    <div class="demo-container">
        <h1>üåê Network Topology Visualization Demo</h1>
        
        <div class="topology-demo">
            <h2 style="margin-bottom: 20px;">Ring Topology (6 peers)</h2>
            <div id="ringDemo"></div>
        </div>
        
        <div class="topology-demo">
            <h2 style="margin-bottom: 20px;">Line Topology (5 peers)</h2>
            <div id="lineDemo"></div>
        </div>
        
        <div class="topology-demo">
            <h2 style="margin-bottom: 20px;">Mesh Topology (6 peers)</h2>
            <div id="meshDemo"></div>
        </div>
        
        <div style="text-align: center; margin-top: 30px; padding: 20px; background: #1e293b; border-radius: 12px;">
            <h3>Features Showcase:</h3>
            <ul style="text-align: left; max-width: 600px; margin: 20px auto;">
                <li>‚úÖ Nodes hi·ªÉn th·ªã Peer ID</li>
                <li>‚úÖ Status indicator (Active/Disabled) v·ªõi m√†u s·∫Øc</li>
                <li>‚úÖ Information panel b√™n c·∫°nh m·ªói node</li>
                <li>‚úÖ Real-time metrics: Loss v√† MSE</li>
                <li>‚úÖ Neighbors list</li>
                <li>‚úÖ Clickable action buttons (Edit, On/Off)</li>
                <li>‚úÖ Visual connections gi·ªØa c√°c peers</li>
                <li>‚úÖ Legend gi·∫£i th√≠ch m√†u s·∫Øc</li>
            </ul>
        </div>
    </div>

    <script>
        // Mock data generator
        function generateMockData(numPeers, topology, topologyType) {
            const peerMetrics = {};
            for (let i = 0; i < numPeers; i++) {
                peerMetrics[i] = {
                    train_loss: Math.random() * 0.5 + 0.1,
                    eval_mse: Math.random() * 0.3 + 0.05,
                    enabled: i === 2 ? false : true // Disable peer 2 for demo
                };
            }
            
            return {
                topology: topology,
                topology_info: {
                    type: topologyType,
                    num_peers: numPeers,
                    total_edges: Object.values(topology).reduce((sum, neighbors) => sum + neighbors.length, 0)
                },
                peer_metrics: peerMetrics
            };
        }

        // Simplified render function for demo
        function renderTopologyDemo(containerId, data) {
            const container = document.getElementById(containerId);
            const topology = data.topology;
            const topologyInfo = data.topology_info;
            const peerMetrics = data.peer_metrics;
            
            const width = 900;
            const height = 600;
            const numPeers = Object.keys(topology).length;
            
            const positions = calculatePositions(numPeers, topologyInfo.type, width, height);
            
            let svg = `
                <div style="background: #0f172a; padding: 20px; border-radius: 8px;">
                    <div style="text-align: center; margin-bottom: 15px; opacity: 0.8;">
                        ${numPeers} peers ‚Ä¢ ${topologyInfo.total_edges} connections
                    </div>
                    <svg width="${width}" height="${height}" style="border: 2px solid #334155; border-radius: 12px; background: #1e293b;">
            `;
            
            // Draw edges
            Object.keys(topology).forEach(peerId => {
                const neighbors = topology[peerId];
                const fromPos = positions[peerId];
                
                neighbors.forEach(neighborId => {
                    const toPos = positions[neighborId];
                    svg += `<line x1="${fromPos.x}" y1="${fromPos.y}" x2="${toPos.x}" y2="${toPos.y}" 
                            stroke="#475569" stroke-width="2.5" opacity="0.6" stroke-dasharray="5,3" />`;
                });
            });
            
            // Draw nodes with info panels
            Object.keys(topology).forEach(peerId => {
                const pos = positions[peerId];
                const metrics = peerMetrics[peerId];
                const neighbors = topology[peerId];
                const isEnabled = metrics.enabled;
                
                const nodeColor = isEnabled ? '#10b981' : '#ef4444';
                const nodeStroke = isEnabled ? '#34d399' : '#f87171';
                const nodeSize = 35;
                
                // Glow effect
                if (isEnabled) {
                    svg += `<circle cx="${pos.x}" cy="${pos.y}" r="${nodeSize + 5}" 
                            fill="${nodeColor}" opacity="0.2" />`;
                }
                
                // Node circle
                svg += `<circle cx="${pos.x}" cy="${pos.y}" r="${nodeSize}" 
                        fill="${nodeColor}" stroke="${nodeStroke}" stroke-width="3" 
                        opacity="${isEnabled ? 1 : 0.6}" 
                        style="filter: drop-shadow(0 4px 6px rgba(0,0,0,0.4));" />`;
                
                // Peer ID
                svg += `<text x="${pos.x}" y="${pos.y + 6}" text-anchor="middle" 
                        fill="#ffffff" font-size="16" font-weight="bold">P${peerId}</text>`;
                
                // Status indicator
                const statusText = isEnabled ? '‚óè' : '‚óã';
                const statusColor = isEnabled ? '#34d399' : '#f87171';
                svg += `<text x="${pos.x + nodeSize - 8}" y="${pos.y - nodeSize + 12}" 
                        fill="${statusColor}" font-size="20">${statusText}</text>`;
                
                // Info panel
                const panelX = pos.x + nodeSize + 15;
                const panelY = pos.y - 50;
                const panelWidth = 180;
                const panelHeight = 110;
                
                svg += `<rect x="${panelX}" y="${panelY}" width="${panelWidth}" height="${panelHeight}" 
                        rx="8" fill="#0f172a" stroke="#334155" stroke-width="2" opacity="0.95" />`;
                
                let textY = panelY + 20;
                svg += `<text x="${panelX + 10}" y="${textY}" fill="${statusColor}" 
                        font-size="12" font-weight="600">${isEnabled ? '‚úì ACTIVE' : '‚úó DISABLED'}</text>`;
                textY += 18;
                
                svg += `<text x="${panelX + 10}" y="${textY}" fill="#94a3b8" font-size="11">
                        Neighbors: ${neighbors.join(', ')}</text>`;
                textY += 18;
                
                svg += `<text x="${panelX + 10}" y="${textY}" fill="#a78bfa" font-size="11" font-weight="600">
                        Loss: ${metrics.train_loss.toFixed(4)}</text>`;
                textY += 16;
                
                svg += `<text x="${panelX + 10}" y="${textY}" fill="#60a5fa" font-size="11" font-weight="600">
                        MSE: ${metrics.eval_mse.toFixed(4)}</text>`;
                
                // Buttons
                const buttonY = panelY + panelHeight + 10;
                svg += `<rect x="${panelX}" y="${buttonY}" width="55" height="22" rx="4" 
                        fill="#3b82f6" opacity="0.8" style="cursor: pointer;" />
                        <text x="${panelX + 27.5}" y="${buttonY + 15}" text-anchor="middle" 
                        fill="#ffffff" font-size="10" font-weight="600">EDIT</text>`;
                
                const toggleColor = isEnabled ? '#ef4444' : '#10b981';
                const toggleText = isEnabled ? 'OFF' : 'ON';
                svg += `<rect x="${panelX + 60}" y="${buttonY}" width="55" height="22" rx="4" 
                        fill="${toggleColor}" opacity="0.8" style="cursor: pointer;" />
                        <text x="${panelX + 87.5}" y="${buttonY + 15}" text-anchor="middle" 
                        fill="#ffffff" font-size="10" font-weight="600">${toggleText}</text>`;
            });
            
            svg += `</svg>
                <div style="display: flex; justify-content: center; gap: 30px; margin-top: 20px; padding: 15px; background: #1e293b; border-radius: 8px;">
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <div style="width: 20px; height: 20px; border-radius: 50%; background: #10b981;"></div>
                        <span style="font-size: 0.9em;">Active</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <div style="width: 20px; height: 20px; border-radius: 50%; background: #ef4444;"></div>
                        <span style="font-size: 0.9em;">Disabled</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <div style="width: 30px; height: 2px; background: #475569;"></div>
                        <span style="font-size: 0.9em;">Connection</span>
                    </div>
                </div>
            </div>`;
            
            container.innerHTML = svg;
        }

        function calculatePositions(numPeers, topologyType, width, height) {
            const centerX = width / 2;
            const centerY = height / 2;
            const radius = Math.min(width, height) * 0.32;
            const positions = {};
            
            if (topologyType === 'ring') {
                for (let i = 0; i < numPeers; i++) {
                    const angle = (2 * Math.PI * i) / numPeers - Math.PI / 2;
                    positions[i] = {
                        x: centerX + radius * Math.cos(angle),
                        y: centerY + radius * Math.sin(angle)
                    };
                }
            } else if (topologyType === 'line') {
                const spacing = (width - 200) / (numPeers - 1);
                for (let i = 0; i < numPeers; i++) {
                    positions[i] = {
                        x: 100 + i * spacing,
                        y: centerY
                    };
                }
            } else if (topologyType === 'mesh') {
                const cols = Math.ceil(Math.sqrt(numPeers));
                const rows = Math.ceil(numPeers / cols);
                const spacingX = (width - 200) / cols;
                const spacingY = (height - 200) / rows;
                
                for (let i = 0; i < numPeers; i++) {
                    const col = i % cols;
                    const row = Math.floor(i / cols);
                    positions[i] = {
                        x: 100 + col * spacingX,
                        y: 100 + row * spacingY
                    };
                }
            }
            
            return positions;
        }

        // Generate and render demos
        const ringTopology = {0: [1, 5], 1: [0, 2], 2: [1, 3], 3: [2, 4], 4: [3, 5], 5: [4, 0]};
        const lineTopology = {0: [1], 1: [0, 2], 2: [1, 3], 3: [2, 4], 4: [3]};
        const meshTopology = {0: [1, 2], 1: [0, 3, 4], 2: [0, 5], 3: [1, 4], 4: [1, 3, 5], 5: [2, 4]};

        renderTopologyDemo('ringDemo', generateMockData(6, ringTopology, 'ring'));
        renderTopologyDemo('lineDemo', generateMockData(5, lineTopology, 'line'));
        renderTopologyDemo('meshDemo', generateMockData(6, meshTopology, 'mesh'));
    </script>
</body>
</html>
